<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OnlyWorks - Connect Students with Employers</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header id="header">
    <nav class="container">
      <a href="/" class="logo">
        <i class="fas fa-briefcase"></i>
        OnlyWorks
      </a>
      <ul class="nav-links">
        <li><a href="#features">Features</a></li>
        <li><a href="#about">About</a></li>
        <li id="nav-auth-link"><a href="/auth/google" class="cta-button">Sign In</a></li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <div class="container hero-content">
      <div class="hero-text">
        <h1 class="hero-title">Connect Students with Employers</h1>
        <p class="hero-subtitle">
          Find flexible part-time jobs that fit your schedule, or discover talented students ready to contribute to your business.
        </p>
        <div class="hero-btns">
          <button class="btn btn-primary" onclick="startAuth()">
            <i class="fab fa-google"></i>
            Sign in with Google
          </button>
        </div>
        
        <!-- Show auth errors if any -->
        <div id="auth-error" class="error-message" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span id="error-text"></span>
        </div>
      </div>
      
      <div class="hero-img">
        <div class="hero-visual">
          <i class="fas fa-users hero-icon"></i>
          <p>Students & Employers Together</p>
        </div>
      </div>
    </div>
  </section>

  <section class="features" id="features">
    <div class="container">
      <h2 class="section-title">How It Works</h2>
      
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fab fa-google"></i>
          </div>
          <h3 class="feature-title">1. Sign In Securely</h3>
          <p class="feature-desc">Use your Google account for quick, secure authentication.</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-user-edit"></i>
          </div>
          <h3 class="feature-title">2. Complete Your Profile</h3>
          <p class="feature-desc">Tell us whether you're a student or employer and add your details.</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-handshake"></i>
          </div>
          <h3 class="feature-title">3. Start Connecting</h3>
          <p class="feature-desc">Find the perfect match for your needs.</p>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Check URL parameters for errors
    const urlParams = new URLSearchParams(window.location.search);
    const error = urlParams.get('error');
    
    if (error) {
      const errorDiv = document.getElementById('auth-error');
      const errorText = document.getElementById('error-text');
      
      let message = 'Authentication failed. Please try again.';
      if (error === 'oauth_failed') {
        message = 'Google sign-in failed. Please try again.';
      } else if (error === 'auth_required') {
        message = 'Please sign in to access that page.';
      }
      
      errorText.textContent = message;
      errorDiv.style.display = 'block';
    }
    
    // Check if user is already logged in
    fetch('/api/user', { credentials: 'include' })
      .then(response => {
        if (response.ok) {
          return response.json();
        }
        throw new Error('Not authenticated');
      })
      .then(data => {
        // User is logged in, update UI
        updateUIForLoggedInUser(data.user);
      })
      .catch(error => {
        // User not logged in, keep default UI
        console.log('User not authenticated');
      });
    
    function updateUIForLoggedInUser(user) {
      const navAuthLink = document.getElementById('nav-auth-link');
      const heroBtn = document.querySelector('.hero-btns .btn-primary');
      
      // Update navigation
      navAuthLink.innerHTML = `
        <a href="/dashboard.html" class="cta-button">
          <img src="${user.avatar}" alt="${user.name}" style="width: 20px; height: 20px; border-radius: 50%; margin-right: 8px;">
          Dashboard
        </a>
      `;
      
      // Update hero button
      heroBtn.innerHTML = '<i class="fas fa-tachometer-alt"></i> Go to Dashboard';
      heroBtn.onclick = () => location.href = '/dashboard.html';
    }
    
    function startAuth() {
      console.log('Starting OAuth flow...');
      window.location.href = '/auth/google';
    }
  </script>
</body>
</html>