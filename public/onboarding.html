<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to OnlyWorks - Setup Your Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="onboarding-container">
    <div class="onboarding-card">
      <div class="onboarding-header">
        <div class="logo">
          <i class="fas fa-briefcase"></i>
          OnlyWorks
        </div>
        <h1>Welcome! Let's set up your profile</h1>
        <p id="welcome-message">Loading your information...</p>
      </div>
      
      <form id="onboarding-form" class="onboarding-form">
        <div class="form-group">
          <label for="role">I am a:</label>
          <select id="role" name="role" required>
            <option value="">Select your role</option>
            <option value="student">Student looking for work</option>
            <option value="employer">Employer seeking talent</option>
          </select>
        </div>
        
        <div class="form-group" id="company-group" style="display: none;">
          <label for="company">Company Name:</label>
          <input type="text" id="company" name="company" placeholder="Enter your company name">
        </div>
        
        <div class="form-group" id="job-title-group" style="display: none;">
          <label for="jobTitle">Job Title:</label>
          <input type="text" id="jobTitle" name="jobTitle" placeholder="e.g., HR Manager, Recruiter">
        </div>
        
        <div class="form-group">
          <label for="location">Location:</label>
          <input type="text" id="location" name="location" placeholder="City, State or Remote">
        </div>
        
        <div class="form-group">
          <label for="bio">Tell us about yourself:</label>
          <textarea id="bio" name="bio" rows="4" placeholder="Brief description about yourself or your company..."></textarea>
        </div>
        
        <div class="form-group" id="skills-group">
          <label for="skills">Skills/Interests:</label>
          <input type="text" id="skills" name="skills" placeholder="e.g., customer service, data entry, marketing">
          <small>Separate multiple items with commas</small>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submit-btn">
            <i class="fas fa-check"></i>
            Complete Setup
          </button>
        </div>
        
        <div id="form-error" class="error-message" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span id="error-text"></span>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentUser = null;
    
    // Load user information
    fetch('/api/user', { credentials: 'include' })
      .then(response => response.json())
      .then(data => {
        if (data.success && data.user) {
          currentUser = data.user;
          document.getElementById('welcome-message').textContent = `Hello ${data.user.name}!`;
          
          // Pre-fill any existing profile data
          if (data.user.profile) {
            const profile = data.user.profile;
            if (profile.role) document.getElementById('role').value = profile.role;
            if (profile.company) document.getElementById('company').value = profile.company;
            if (profile.jobTitle) document.getElementById('jobTitle').value = profile.jobTitle;
            if (profile.location) document.getElementById('location').value = profile.location;
            if (profile.bio) document.getElementById('bio').value = profile.bio;
            if (profile.skills) document.getElementById('skills').value = profile.skills.join(', ');
            
            // Show/hide fields based on role
            updateFormFields();
          }
        }
      })
      .catch(error => {
        console.error('Error loading user:', error);
        window.location.href = '/';
      });
    
    // Update form fields based on selected role
    document.getElementById('role').addEventListener('change', updateFormFields);
    
    function updateFormFields() {
      const role = document.getElementById('role').value;
      const companyGroup = document.getElementById('company-group');
      const jobTitleGroup = document.getElementById('job-title-group');
      const skillsLabel = document.querySelector('#skills-group label');
      const skillsInput = document.getElementById('skills');
      
      if (role === 'employer') {
        companyGroup.style.display = 'block';
        jobTitleGroup.style.display = 'block';
        skillsLabel.textContent = 'Industry/Skills Needed:';
        skillsInput.placeholder = 'e.g., retail, food service, tech support';
      } else if (role === 'student') {
        companyGroup.style.display = 'none';
        jobTitleGroup.style.display = 'none';
        skillsLabel.textContent = 'Skills/Interests:';
        skillsInput.placeholder = 'e.g., customer service, data entry, marketing';
      } else {
        companyGroup.style.display = 'none';
        jobTitleGroup.style.display = 'none';
      }
    }
    
    // Handle form submission
    document.getElementById('onboarding-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const profileData = {
        role: formData.get('role'),
        company: formData.get('company'),
        jobTitle: formData.get('jobTitle'),
        location: formData.get('location'),
        bio: formData.get('bio'),
        skills: formData.get('skills') ? formData.get('skills').split(',').map(s => s.trim()) : []
      };
      
      const submitBtn = document.getElementById('submit-btn');
      const errorDiv = document.getElementById('form-error');
      const errorText = document.getElementById('error-text');
      
      // Show loading state
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Setting up...';
      submitBtn.disabled = true;
      errorDiv.style.display = 'none';
      
      try {
        const response = await fetch('/api/complete-onboarding', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(profileData)
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Success - redirect to dashboard
          window.location.href = '/dashboard.html';
        } else {
          throw new Error(result.error || 'Profile update failed');
        }
        
      } catch (error) {
        console.error('Profile update error:', error);
        errorText.textContent = error.message || 'Failed to update profile. Please try again.';
        errorDiv.style.display = 'block';
        
        // Reset button
        submitBtn.innerHTML = '<i class="fas fa-check"></i> Complete Setup';
        submitBtn.disabled = false;
      }
    });
  </script>
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <div class="footer-logo">
            <i class="fas fa-briefcase logo-icon"></i>
            OnlyWorks
          </div>
          <p class="footer-desc">
            OnlyWorks helps students find flexible part-time work that fits their schedule, connecting them directly with employers on campus and in their local communities.
          </p>
          <div class="footer-social">
            <a href="https://www.linkedin.com/company/only-jobs-students/" class="social-icon">
              <span style="font-weight: bold; font-size: 0.9em;">in</span>
            </a>
          </div>
        </div>
        
        <div class="footer-links">
          <h4>Company</h4>
          <ul class="footer-menu">
            <li><a href="aboutus.html" class="footer-menu-item">About Us</a></li>
            <li><a href="team.html" class="footer-menu-item">Our Team</a></li>
            <li><a href="#" class="footer-menu-item">Careers</a></li>
            <li><a href="#" class="footer-menu-item">Press</a></li>
          </ul>
        </div>
        
        <div class="footer-links">
          <h4>Resources</h4>
          <ul class="footer-menu">
            <li><a href="#" class="footer-menu-item">Help Center</a></li>
            <li><a href="#" class="footer-menu-item">Student Guide</a></li>
            <li><a href="#" class="footer-menu-item">Employer Guide</a></li>
            <li><a href="/auth/google" class="footer-menu-item">Try Demo</a></li>
          </ul>
        </div>
        
        <div class="footer-links">
          <h4>Legal</h4>
          <ul class="footer-menu">
            <li><a href="#" class="footer-menu-item">Terms of Service</a></li>
            <li><a href="#" class="footer-menu-item">Privacy Policy</a></li>
            <li><a href="#" class="footer-menu-item">Cookie Policy</a></li>
            <li><a href="#" class="footer-menu-item">Security</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 OnlyWorks. All rights reserved.</p>
      </div>
    </div>
  </footer>

</body>
</html>
